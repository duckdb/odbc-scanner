# name: test/sql/duckdb/duckdb_copy.test
# description: test for 'copy()' function
# group: [duckdb_copy]

require odbc_scanner

statement ok
SET VARIABLE conn = odbc_connect('ODBCSCANNER_DEBUG_CONN_STRING_ENV_VAR=ODBC_CONN_STRING')

# invalid batch size

statement error
SELECT completed, rows_processed FROM odbc_copy(getvariable('conn'),
  dest_table='duckdb_test_copy',
  create_table=TRUE,
  batch_size=3,
  source_query='SELECT 42::INTEGER'
)
----
supported values: 1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048

# user options

query II
SELECT completed, rows_processed FROM odbc_copy(getvariable('conn'),
  dest_table='duckdb_test_copy',
  create_table=TRUE,
  decimal_params_as_chars=TRUE,
  integral_params_as_decimals=TRUE,
  source_conn_string=':memory:',
  source_query='SELECT ''foo''::VARCHAR AS col1',
  column_types=MAP {'DUCKDB_TYPE_VARCHAR': 'VARCHAR'}
)
----
1	1

statement ok
SELECT * FROM odbc_query(getvariable('conn'), 'DROP TABLE duckdb_test_copy')

statement ok
SELECT odbc_close(getvariable('conn'))
