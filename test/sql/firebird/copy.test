# name: test/sql/firebird/copy.test
# description: test odbc_copy() function with Firebird
# group: [firebird_copy]

require odbc_scanner

statement ok
SET VARIABLE conn = odbc_connect('ODBCSCANNER_DEBUG_CONN_STRING_ENV_VAR=ODBC_CONN_STRING')

statement ok
FROM odbc_query(getvariable('conn'), 'DROP TABLE "duckdb_test_copy"', ignore_exec_failure=TRUE)

# dest query with a tail

statement ok
FROM odbc_query(getvariable('conn'),
  'CREATE TABLE "duckdb_test_copy" (
    col1_1 INTEGER,
    col1_2 VARCHAR(10),
    col2_1 INTEGER,
    col2_2 VARCHAR(10),
    col3_1 INTEGER,
    col3_2 VARCHAR(10),
    col4_1 INTEGER,
    col4_2 VARCHAR(10)
  )')


query II
SELECT completed, rows_processed FROM odbc_copy(getvariable('conn'),
  create_table=FALSE,
  batch_size=4,
  source_queries=[
    'CREATE TABLE copy_test_dest_query(
      col1 INTEGER,
      col2 VARCHAR
    )',
    'INSERT INTO copy_test_dest_query VALUES 
      (1, ''s1''),
      (2, ''s2''),
      (3, ''s3''),
      (4, ''s4''),
      (5, ''s5''),
      (6, ''s6''),
      (7, ''s7''),
      (8, ''s8''),
      (9, ''s9''),
      (10, ''s10''),
      (11, ''s11'')
    ',
    'SELECT * FROM copy_test_dest_query'
    ],
  dest_query='INSERT INTO "duckdb_test_copy" VALUES(?,?,?,?,?,?,?,?)',
  dest_query_single='INSERT INTO "duckdb_test_copy" VALUES(NULL,NULL,?,?,NULL,NULL,NULL,NULL)'
  )
----
1	11

query IIIIIIII
SELECT * FROM odbc_query(getvariable('conn'), 'SELECT * FROM "duckdb_test_copy"')
----
1	s1	2	s2	3	s3	4	s4
5	s5	6	s6	7	s7	8	s8
NULL	NULL	9	s9	NULL	NULL	NULL	NULL
NULL	NULL	10	s10	NULL	NULL	NULL	NULL
NULL	NULL	11	s11	NULL	NULL	NULL	NULL

statement ok
SELECT * FROM odbc_query(getvariable('conn'), 'DROP TABLE "duckdb_test_copy"')

statement ok
SELECT odbc_close(getvariable('conn'))
